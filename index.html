<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Filters</title>
    <link rel="stylesheet" href="/style.css" />
    <style>
      body {
        text-align: center;
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
      }

      h1,
      h2 {
        color: #333;
      }

      .camera-container {
        position: relative;
        display: inline-block;
      }

      video,
      canvas {
        width: 400px;
        height: 300px;
        border-radius: 10px;
        border: 2px solid #ddd;
      }

      .filters,
      .controls {
        margin: 10px;
      }

      button {
        margin: 5px;
        padding: 10px 15px;
        border: none;
        background-color: #3498db;
        color: white;
        cursor: pointer;
        border-radius: 5px;
      }

      button:hover {
        background-color: #2980b9;
      }

      .photo-booth {
        margin-top: 20px;
      }

      #stripCanvas {
        width: 400px;
        height: 500px;
        border: 2px solid black;
        background: white;
      }
    </style>
  </head>
  <body>
    <div>
      <h1>Apply Filters</h1>
    </div>
    <div class="centrediv">
      <canvas id="imageCanvas"></canvas>
    </div>
    <div class="centrediv">
      <h2>Load an Image</h2>
      <input
        type="file"
        multiple="false"
        id="image"
        class="btn"
        onchange="loadImage()"
      />
    </div>
    <div class="centrediv">
      <h2>Choose Filter</h2>
      <input
        type="button"
        value="Greyscale"
        class="btn"
        onclick="grayscale()"
      />
      <input type="button" value="Red" class="btn" onclick="red()" />
      <input type="button" value="Yellow" class="btn" onclick="yellow()" />
      <input type="button" value="Golden" class="btn" onclick="golden()" />
      <input type="button" value="Rainbow" class="btn" onclick="rainbow()" />
      <input type="button" value="Blue" class="btn" onclick="custom()" />
      <input type="button" value="Reset" class="btn" onclick="reset()" />
      <input
        type="button"
        value="Download Image"
        class="btn"
        onclick="downloadImage()"
      />
    </div>
  </body>
  <script src="https://www.dukelearntoprogram.com/course1/common/js/image/SimpleImage.js"></script>
  <script>
    // Only use imageCanvas for this app
    let imageCanvas = document.getElementById("imageCanvas");
    let imgCtx = imageCanvas.getContext("2d");
    let selectedFilter = "none";

    function loadImage() {
      let file = document.getElementById("image").files[0];
      if (!file) return;
      let reader = new FileReader();
      reader.onload = function (event) {
        let img = new Image();
        img.onload = function () {
          imageCanvas.width = img.width;
          imageCanvas.height = img.height;
          imgCtx.drawImage(img, 0, 0);
          selectedFilter = "none";
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    }

    function applyFilterToCanvas(filter) {
      if (!imageCanvas.width || !imageCanvas.height) return;
      let imageData = imgCtx.getImageData(
        0,
        0,
        imageCanvas.width,
        imageCanvas.height
      );
      let data = imageData.data;
      for (let i = 0; i < data.length; i += 4) {
        let filteredData = processFilter(
          data[i],
          data[i + 1],
          data[i + 2],
          filter
        );
        data[i] = filteredData[0];
        data[i + 1] = filteredData[1];
        data[i + 2] = filteredData[2];
      }
      imgCtx.putImageData(imageData, 0, 0);
      selectedFilter = filter;
    }

    function processFilter(r, g, b, filter) {
      switch (filter) {
        case "greyscale":
          let avg = (r + g + b) / 3;
          return [avg, avg, avg];
        case "red":
          return [r, 0, 0];
        case "yellow":
          return [r, g, 0];
        case "golden":
          return [r * 1.2, g * 1.1, b * 0.7];
        case "rainbow":
          return [r * 1.5, g * 1.2, b * 1.5];
        case "blue":
          return [0, 0, b];
        default:
          return [r, g, b];
      }
    }

    function grayscale() {
      applyFilterToCanvas("greyscale");
    }
    function red() {
      applyFilterToCanvas("red");
    }
    function yellow() {
      applyFilterToCanvas("yellow");
    }
    function golden() {
      applyFilterToCanvas("golden");
    }
    function rainbow() {
      applyFilterToCanvas("rainbow");
    }
    function custom() {
      applyFilterToCanvas("blue");
    }

    function reset() {
      if (!imageCanvas.width || !imageCanvas.height) return;
      // Reload the image from the file input
      loadImage();
    }

    function downloadImage() {
      if (!imageCanvas.width || !imageCanvas.height) return;
      let link = document.createElement("a");
      link.download = "filtered_image.png";
      link.href = imageCanvas.toDataURL("image/png");
      link.click();
    }
  </script>
</html>
